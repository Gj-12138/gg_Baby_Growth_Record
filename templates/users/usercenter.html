{% extends 'base/base.html' %}
{% load template_tags_filters %}

{% block title %}
    用户中心
{% endblock %}
{% block style %}
    <style>
        #usercenterform input{

        }
        #avatar{
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid  lightgray;
            background: url("/media/{{ request.user.avatar }}") no-repeat center;
            background-size: cover;
            padding-bottom: 20px;
            {#background-image: url("");#}
        }
        #avatar input{
            display: block;
            width: 100%;
            height: 100%;
            opacity: 0;
        }
    </style>
{% endblock %}
{% block script %}
    <script>
        window.onload = function (){
            let head_input = document.querySelector("#avatar input");
            let head = document.querySelector("#avatar")
            head_input.onchange = function (){
                const filrReader = new FileReader()
                filrReader.onload = function (e){
                    console.log(e.target.result)
                    head.style.backgroundImage = `url(${e.target.result})`
                }
                filrReader.readAsDataURL(this.files[0])
            }
        }
    </script>
{% endblock %}

{% block body %}
    <div style="width: 600px">
        <div class="row-md-8">
              <div class="col-md-8  col-md-offset-12 ">
                    <h3>欢迎{{ request.user.username }}，来到用户中心</h3>
                  <fieldset disabled>
                            {% csrf_token %}
                            {{ form.headerimg.label_tag }}
                            <div id="avatar">
                                {{ form.headerimg }}
                            </div>
                      <hr>
                            {{ form.username.label_tag }}
                            {{ form.username }}
                      <hr>
                  </fieldset>
                  <a href="{% url 'users:usercenterchange' %}"><button type="button">修改</button></a>


              </div>
        </div>
    </div>
    {% if register_form.errors %}
          <script>
            // 将错误文本合并成一句
            const errList = [
              {% for field, errs in register_form.errors.items %}
                {% for e in errs %}
                  "{{ e|escapejs }}",
                {% endfor %}
              {% endfor %}
            ];
            alert("提交失败！\n" + errList.join("\n"));
          </script>
    {% endif %}
{% endblock %}